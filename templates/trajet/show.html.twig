{% extends 'base.html.twig' %}

{% block title %}DÃ©tails du trajet - EcoRide{% endblock %}

{% block body %}
<main class="container mt-4">
    <section class="card shadow-sm">
        <header class="card-header bg-primary text-white">
            <h2 class="mb-0">Trajet de {{ trajet.depart }} Ã  {{ trajet.destination }}</h2>
        </header>
        <div class="card-body">
            <p><strong>Date et heure :</strong> {{ trajet.dateHeure|date('d/m/Y H:i') }}</p>
            <p><strong>Places restantes :</strong> {{ trajet.nbPlaces }}</p>
            <p><strong>Prix :</strong> {{ trajet.prix }} â‚¬</p>
            <p><strong>Description :</strong> {{ trajet.description ?: 'Aucune description' }}</p>
            <p><strong>CrÃ©Ã© par :</strong> {{ trajet.user.email }}</p>
        </div>
    </section>

    <section class="mt-4">
        {% if app.user %}
            {% if app.user == trajet.user %}
                <div class="alert alert-info mt-3">
                    ğŸš— Vous Ãªtes l'auteur de ce trajet.
                </div>

                {% if trajet.reservations|length > 0 %}
                    <div class="card mt-3">
                        <div class="card-header bg-secondary text-white">Passagers ayant rÃ©servÃ© :</div>
                        <ul class="list-group list-group-flush">
                            {% for reservation in trajet.reservations %}
                                <li class="list-group-item">
                                    ğŸ‘¤ {{ reservation.user.email }} - {{ reservation.places }} place(s)
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% else %}
                    <p class="mt-3">Aucun passager pour le moment.</p>
                {% endif %}

            {% else %}
                {% set dejaReserve = false %}
                {% for reservation in trajet.reservations %}
                    {% if reservation.user == app.user %}
                        {% set dejaReserve = true %}
                    {% endif %}
                {% endfor %}

                {% if dejaReserve %}
                    <div class="alert alert-warning mt-3">
                        âœ… Vous avez dÃ©jÃ  rÃ©servÃ© ce trajet.
                    </div>
                {% elseif trajet.nbPlaces < 1 %}
                    <div class="alert alert-danger mt-3">
                        âŒ Ce trajet est complet.
                    </div>
                {% else %}
                    <a href="{{ path('app_reservation_new', {id: trajet.id}) }}" class="btn btn-success mt-3">
                        RÃ©server une place ğŸšŒ
                    </a>
                {% endif %}
            {% endif %}
        {% else %}
            <div class="alert alert-warning mt-3">
                ğŸ”’ Connectez-vous pour rÃ©server ce trajet.
            </div>
        {% endif %}
    </section>

    <footer class="mt-4">
        <a href="{{ path('app_trajet_index') }}" class="btn btn-outline-secondary">â¬…ï¸ Retour Ã  la liste</a>
    </footer>
</main>
{% endblock %}
